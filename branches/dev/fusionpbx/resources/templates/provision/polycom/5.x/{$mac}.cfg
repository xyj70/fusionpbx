<phone>
	<!-- Enable Remote Pcap -->
	<capture
		diags.pcap.enabled="1"
		diags.pcap.remote.enabled="1" 
	/>

	<!-- NAT Keepalive Interval -->
	<network
		nat.keepalive.interval="5"
	/>

	<!-- Enable Polycom Paging -->
	<ptt 
		ptt.pageMode.enable="1"
		ptt.pageMode.displayName="INTERCOM"
	/>

	<!-- Enable Features -->

	<!-- Registrations -->
	<reg
		{foreach $lines as $row}reg.{$row.line_number}.displayName="{$row.user_id}" 
		reg.{$row.line_number}.address="{$row.user_id}" 
		reg.{$row.line_number}.label="{$row.user_id}" 
		reg.{$row.line_number}.type="private" 
		reg.{$row.line_number}.lcs="" 
		reg.{$row.line_number}.thirdPartyName="{$row.display_name}" 
		reg.{$row.line_number}.auth.userId="{$row.user_id}" 
		reg.{$row.line_number}.auth.password="{$row.password}" 
		reg.{$row.line_number}.lineKeys="{$line_key_value_{$row.line_number}}" 
		reg.{$row.line_number}.auth.optimizedInFailover="" 
		{if isset($row.outbound_proxy)}reg.{$row.line_number}.outboundProxy.address = "{$row.outbound_proxy}"
		{/if}
		{if isset($row.sip_port)}reg.{$row.line_number}.outboundProxy.port="{$row.sip_port}"{else}reg.{$row.line_number}.server.1.port="5060"
		{/if}
		{if $row.sip_transport == ''}reg.{$row.line_number}.outboundProxy.transport="TCPOnly"{/if}
		{if $row.sip_transport == 'tcp'}reg.{$row.line_number}.outboundProxy.transport="TCPOnly"{/if}
		{if $row.sip_transport == 'udp'}reg.{$row.line_number}.outboundProxy.transport="UDPOnly"{/if}
		{if $row.sip_transport == 'tls'}reg.{$row.line_number}.outboundProxy.transport="TLS" {/if}
		{if $row.sip_transport == 'dns srv'}reg.{$row.line_number}.outboundProxy.transport="DNSnaptr"{/if}
		reg.{$row.line_number}.server.1.address="{$row.server_address}"
		{if $row.sip_transport == ''}reg.{$row.line_number}.server.1.transport="TCPOnly"{/if}
		{if $row.sip_transport == 'tcp'}reg.{$row.line_number}.server.1.transport="TCPOnly"{/if}
		{if $row.sip_transport == 'udp'}reg.{$row.line_number}.server.1.transport="UDPOnly"{/if}
		{if $row.sip_transport == 'tls'}reg.{$row.line_number}.server.1.transport="TLS" {/if}
		{if $row.sip_transport == 'dns srv'}reg.{$row.line_number}.server.1.transport="DNSnaptr"{/if}
		{if isset($row.sip_port)}reg.{$row.line_number}.server.1.expires="{$row.register_expires}"{else}reg.{$row.line_number}.server.1.expires="30"{/if}
		{/foreach}
	/>
  
	<!-- Keys -->
	<attendant
		attendant.reg="1"
		attendant.ringType="1"
		attendant.uri=""
		attendant.behaviors.display.spontaneousCallAppearances.normal="1"
		attendant.behaviors.display.spontaneousCallAppearances.automata="1"
		attendant.behaviors.display.remoteCallerID.normal="1"
		attendant.behaviors.display.remoteCallerID.automata="1"
	/>
	<attendant.resourceList 
		{foreach $keys as $row}{if $row.device_key_category == "line"}{if $row.device_key_type != "line"}attendant.resourceList.{$row.device_key_id}.address="{$row.device_key_value}"
		attendant.resourceList.{$row.device_key_id}.callAddress=""
		attendant.resourceList.{$row.device_key_id}.label="{$row.device_key_label}"
		attendant.resourceList.{$row.device_key_id}.proceedingIsRecipient="0" 
		attendant.resourceList.{$row.device_key_id}.type="{$row.device_key_type}"
		{/if}{/if}
		{/foreach}
	/>

	<!-- NTP Settings -->
	<!-- More time zone info at http://www.epochconverter.com/epoch/timezones.php -->
	<SNTP 
		tcpIpApp.sntp.resyncPeriod="86400"
		tcpIpApp.sntp.address="pool.ntp.org" tcpIpApp.sntp.address.overrideDHCP="0"
		tcpIpApp.sntp.gmtOffset="{$polycom_gmt_offset}" tcpIpApp.sntp.gmtOffset.overrideDHCP="0"
		tcpIpApp.sntp.daylightSavings.enable="1" tcpIpApp.sntp.daylightSavings.fixedDayEnable="1"
		tcpIpApp.sntp.daylightSavings.start.month="3" tcpIpApp.sntp.daylightSavings.start.date="28"
		tcpIpApp.sntp.daylightSavings.start.time="2" tcpIpApp.sntp.daylightSavings.start.dayOfWeek="1"
		tcpIpApp.sntp.daylightSavings.start.dayOfWeek.lastInMonth="0"
		tcpIpApp.sntp.daylightSavings.stop.month="9" tcpIpApp.sntp.daylightSavings.stop.date="23"
		tcpIpApp.sntp.daylightSavings.stop.time="2" tcpIpApp.sntp.daylightSavings.stop.dayOfWeek="0"
		tcpIpApp.sntp.daylightSavings.stop.dayOfWeek.lastInMonth="0"
	/>

	<!-- Dialplan -->
	<map
		dialplan.digitmap="[*]xxxx|[2-9]11|0T|011xxx.T|[0-1][2-9]xxxxxxxxx|[2-9]xxxxxxxxx|[1-9]xxT|**x.T" 
	/>

	<!-- Enable Phone to reboot upon SIP NOTIFY from Fusion -->
	<special
		voIpProt.SIP.specialEvent.checkSync.alwaysReboot="1" 
	/>

	<!-- MWI -->
	<mwi
		msg.mwi.1.callBackMode="contact" 
		msg.mwi.1.callBack="*97"
		msg.bypassInstantMessage="1"
	/>
 
	<DEVICE_SETTINGS
		device.set="1"
		device.auth.localAdminPassword.set="1"
		device.auth.localAdminPassword="{$admin_password}" 

		device.prov.user.set="1"
		device.prov.user="{$http_auth_username}"
		device.prov.password.set="1"
		device.prov.password="{$http_auth_password}"
		device.prov.redunAttemptLimit.set="1"

		device.prov.upgradeServer="{$domain_name}/app/provision"
		device.prov.upgradeServer.set="1"
		device.prov.serverName="{$domain_name}/app/provision"
		device.prov.serverName.set="1"
		device.prov.serverType.set="1"
		device.prov.serverType="HTTPS"

		device.dns.serverAddress.set="1"
		device.dns.serverAddress="4.2.2.1"
		device.dns.altSrvAddress.set="1"
		device.dns.altSrvAddress="8.8.8.8"
	/>
</phone>