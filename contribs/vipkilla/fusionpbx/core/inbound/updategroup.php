<?php/*	FusionPBX	Version: MPL 1.1	The contents of this file are subject to the Mozilla Public License Version	1.1 (the "License"); you may not use this file except in compliance with	the License. You may obtain a copy of the License at	http://www.mozilla.org/MPL/	Software distributed under the License is distributed on an "AS IS" basis,	WITHOUT WARRANTY OF ANY KIND, either express or implied. See the License	for the specific language governing rights and limitations under the	License.	The Original Code is FusionPBX	The Initial Developer of the Original Code is	Mark J Crane <markjcrane@fusionpbx.com>	Portions created by the Initial Developer are Copyright (C) 2008-2010	the Initial Developer. All Rights Reserved.	Contributor(s):	Mark J Crane <markjcrane@fusionpbx.com>	E. Schmidbauer <e.schmidbauer@gmail.com>*/include "root.php";require_once "includes/config.php";require_once "includes/checkauth.php";if (permission_exists("ingroup_add") ||	permission_exists("ingroup_edit") || 	permission_exists("ingroup_delete") ||	ifgroup("superadmin")) {	//access allowed}else {	echo "access denied";	return;}//get data from the db	if (strlen($_REQUEST["id"])> 0) {		$id = $_REQUEST["id"];	}//get the username from v_users	$sql = "";	$sql .= "select * from v_ingroups ";	$sql .= "where id = '$id' ";	$prepstatement = $db->prepare(check_sql($sql));	$prepstatement->execute();	$result = $prepstatement->fetchAll();	foreach ($result as &$row) {		$name = $row["name"];		break; //limit to 1 row	}	unset ($prepstatement);//required to be a superadmin to update an account that is a member of the superadmin group	$superadminlist = superadminlist($db);	if (ifsuperadmin($superadminlist, $username)) {		if (!ifgroup("superadmin")) { 			echo "access denied";			return;		}	}//delete the group from the user	if ($_GET["a"] == "delete" && permission_exists("ingroup_delete")) {		//set the variables			$groupid = check_str($_GET["groupid"]);		//delete the group from the users			$sql = "delete from v_group_members ";			$sql .= "where v_id = '$v_id' ";			$sql .= "and groupid = '$groupid' ";			$sql .= "and username = '$username' ";			$db->exec(check_sql($sql));		//redirect the user			require_once "includes/header.php";			echo "<meta http-equiv=\"refresh\" content=\"2;url=updategroup.php?id=$id\">\n";			echo "<div align='center'>Update Complete</div>";			require_once "includes/footer.php";			return;	}if (count($_POST)>0 && $_POST["persistform"] != "1") {	$id = $_REQUEST["id"];	$description = check_str($_POST["description"]);	$areacode = check_str($_POST["areacode"]);	$country = check_str($_POST["country"]);	if (strlen($description) == 0) { $msgerror .= "Please provide a description.<br>\n"; }	if (strlen($areacode) == 0) { $msgerror .= "Please provide an area code.<br>\n"; }	if (strlen($country) == 0) { $msgerror .= "Please provide a country.<br>\n"; }	if (strlen($msgerror) > 0) {		require_once "includes/header.php";		echo "<div align='center'>";		echo "<table><tr><td>";		echo $msgerror;		echo "</td></tr></table>";		echo "<br />\n";		require_once "includes/persistform.php";		echo persistform($_POST);		echo "</div>";		require_once "includes/footer.php";		return;	}	//if the template has not been assigned by the superadmin		if (strlen($_SESSION["v_template_name"]) == 0) {			//set the session theme for the active user			if ($_SESSION["username"] == $username) {				$_SESSION["template_name"] = $ingroup_template_name;			}		}	//sql update		$sql  = "update v_ingroups set ";		$sql .= "description = '$description', ";		$sql .= "areacode = '$areacode', ";		$sql .= "country = '$country' ";		$sql .= "where id = '$id' ";		$count = $db->exec(check_sql($sql));	//clear the template so it will rebuild in case the template was changed		$_SESSION["template_content"] = '';	//redirect the user		require_once "includes/header.php";		echo "<meta http-equiv=\"refresh\" content=\"2;url=updategroup.php?id=$id\">\n";		echo "<div align='center'>Update Complete</div>";		require_once "includes/footer.php";		return;}else {	$sql = "";	$sql .= "select * from v_ingroups ";	//allow admin access	if (ifgroup("superadmin")) {		if (strlen($id)> 0) {			$sql .= "where id = '$id' ";		}	}	$prepstatement = $db->prepare(check_sql($sql));	$prepstatement->execute();	$result = $prepstatement->fetchAll();	foreach ($result as &$row) {		if (ifgroup("admin")) {			$username = $row["username"];		}		$description = $row["description"];		$areacode = $row["areacode"];		$country = $row["country"];		break; //limit to 1 row	}}//include the header	require_once "includes/header.php";//show the content	$tablewidth ='width="100%"';	echo "<form method='post' action=''>";	echo "<br />\n";	echo "<div align='center'>";	echo "<table width='100%' border='0' cellpadding='0' cellspacing='2'>\n";	echo "<tr>\n";	echo "<td>\n";	echo "<table $tablewidth cellpadding='3' cellspacing='0' border='0'>";	echo "<td align='left' width='90%' nowrap><b>Inbound Group Manager</b></td>\n";	echo "<td nowrap='nowrap'>\n";	echo "	<input type='submit' name='submit' class='btn' value='Save'>";	echo "	<input type='button' class='btn' onclick=\"window.location='index.php'\" value='Back'>";	echo "</td>\n";	echo "</tr>\n";	echo "<tr>\n";	echo "<td align='left' colspan='2'>\n";	echo "	Edit inbound group information. \n";	echo "</td>\n";	echo "</tr>\n";	echo "</table>\n";	echo "<br />\n";	echo "<table $tablewidth cellpadding='6' cellspacing='0' border='0'>";	echo "<tr>\n";	echo "	<th class='th' colspan='2' align='left'>Inbound Group Info</th>\n";	echo "</tr>\n";	echo "	<tr>";	echo "		<td width='30%' class='vncellreq'>Name:</td>";	echo "		<td width='70%' class='vtable'>$name</td>";	echo "	</tr>";	echo "	<tr>";	echo "		<td class='vncell'>Description: </td>";	echo "		<td class='vtable'><input type='text' class='formfld' name='description' value=\"$description\"></td>";	echo "	</tr>";	echo "	<tr>";	echo "		<td class='vncell'>Area Code:</td>";	echo "		<td class='vtable'><input type='text' class='formfld' name='areacode' value=\"$areacode\"></td>";	echo "	</tr>";	echo "	<tr>";	echo "		<td class='vncell'>Country:</td>";	echo "		<td class='vtable'><input type='text' class='formfld' name='country' value=\"$country\"></td>";	echo "	</tr>";        echo "  <tr>";        echo "          <td class='vtable' colspan='2'><a href='addnumbers.php?cid=${name}'>Add Numbers</a> <a href=\"listgroupnumbers.php?cid=${name}\">List Numbers</a></td>";        echo "  </tr>";	echo "</table>";	echo "<br>";	echo "<br>";	echo "</div>";	echo "</form>";//include the footer	require_once "includes/footer.php";?>